Metadata-Version: 2.4
Name: ocr-mcp
Version: 1.0.0
Summary: Lightweight OCR MCP Server for AI Models
Author: OCR MCP Team
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Topic :: Scientific/Engineering :: Image Recognition
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: mcp>=1.0.0
Requires-Dist: ddddocr==1.5.6
Requires-Dist: Pillow>=10.1.0
Requires-Dist: pydantic>=2.5.0
Requires-Dist: aiofiles>=23.2.1
Provides-Extra: dev
Requires-Dist: pytest>=7.4.3; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.1; extra == "dev"
Requires-Dist: pytest-cov>=4.1.0; extra == "dev"
Requires-Dist: black>=23.12.0; extra == "dev"
Requires-Dist: flake8>=6.1.0; extra == "dev"
Requires-Dist: mypy>=1.7.0; extra == "dev"
Dynamic: license-file

# OCR MCP (Model Context Protocol) 系统

[![Python Version](https://img.shields.io/badge/python-3.8%2B-blue.svg)](https://python.org)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![MCP Protocol](https://img.shields.io/badge/MCP-2024--11--05-orange.svg)](https://modelcontextprotocol.io)

一个基于Python的轻量级OCR MCP服务器，专门为AI模型提供验证码识别和图像预处理功能。系统采用ddddocr引擎，符合MCP 2024-11-05协议标准，完全免费使用。

## ✨ 特性

- 🚀 **轻量级设计**: 无需数据库存储，内存处理，启动即用
- 🔒 **隐私保护**: 不存储任何用户数据，处理完即删除
- 🎯 **高精度识别**: 基于ddddocr引擎的验证码识别
- 🛠️ **图像预处理**: 支持去噪、增强、尺寸调整等操作
- 📡 **标准协议**: 完全符合MCP 2024-11-05协议规范
- 🆓 **完全免费**: 无需注册，无使用限制
- 🔧 **易于集成**: 支持Claude、ChatGPT等主流AI模型

## 🚀 快速开始

### 安装依赖

```bash
# 克隆项目
git clone <repository-url>
cd free_ocr

# 安装依赖
pip install -r requirements.txt

# 或者安装开发依赖
pip install -e ".[dev]"
```

### 启动服务器

```bash
# 方式1: 使用模块启动
python -m ocr_mcp

# 方式2: 使用脚本启动
ocr-mcp-server

# 调试模式
python -m ocr_mcp --debug
```

### 基本使用示例

```python
import asyncio
import base64
from mcp import ClientSession, StdioServerParameters
from mcp.client.stdio import stdio_client

async def main():
    # 连接到OCR MCP服务器
    server_params = StdioServerParameters(
        command="python",
        args=["-m", "ocr_mcp"]
    )
    
    async with stdio_client(server_params) as (read, write):
        async with ClientSession(read, write) as session:
            # 初始化连接
            await session.initialize()
            
            # 获取可用工具列表
            tools = await session.list_tools()
            print(f"可用工具: {[tool.name for tool in tools.tools]}")
            
            # 读取验证码图片
            with open("captcha.png", "rb") as f:
                image_data = base64.b64encode(f.read()).decode()
            
            # 调用验证码识别工具
            result = await session.call_tool(
                "captcha_recognize",
                {
                    "image_data": image_data,
                    "options": {
                        "preprocess": True,
                        "confidence_threshold": 0.8
                    }
                }
            )
            
            print(f"识别结果: {result.content[0].text}")

if __name__ == "__main__":
    asyncio.run(main())
```

## 🛠️ 可用工具

### 1. captcha_recognize - 验证码识别

识别各种类型的验证码图片，基于ddddocr引擎提供高精度识别。

**参数:**
- `image_data` (string): Base64编码的图像数据
- `options` (object, 可选):
  - `preprocess` (boolean): 是否进行图像预处理，默认true
  - `confidence_threshold` (float): 置信度阈值(0-1)，默认0.8

**返回值:**
```json
{
  "type": "text",
  "text": "识别结果: ABCD\n置信度: 0.95\n处理时间: 0.12秒"
}
```

### 2. image_preprocess - 图像预处理

对图像进行预处理优化，包括去噪、对比度增强、尺寸调整等操作。

**参数:**
- `image_data` (string): Base64编码的图像数据
- `operations` (array): 预处理操作列表，可选值: ["denoise", "enhance", "resize"]
- `options` (object, 可选):
  - `contrast` (number): 对比度增强因子，默认1.5
  - `sharpness` (number): 锐化增强因子，默认1.2
  - `max_width` (integer): 最大宽度，默认800
  - `max_height` (integer): 最大高度，默认600
  - `return_processed_image` (boolean): 是否返回处理后的图像数据，默认false

**返回值:**
```json
{
  "type": "text",
  "text": "预处理完成\n应用操作: 去噪, 增强\n处理时间: 0.08秒"
}
```

## 🤖 AI模型集成

### Claude Desktop集成

在Claude Desktop配置文件中添加:

```json
{
  "mcpServers": {
    "ocr-server": {
      "command": "python",
      "args": ["-m", "ocr_mcp"]
    }
  }
}
```

### 自定义AI应用集成

```python
class OCRAssistant:
    def __init__(self):
        self.mcp_session = None
    
    async def connect_ocr_server(self):
        """连接到OCR MCP服务器"""
        server_params = StdioServerParameters(
            command="python",
            args=["-m", "ocr_mcp"]
        )
        
        self.read, self.write = await stdio_client(server_params).__aenter__()
        self.mcp_session = await ClientSession(self.read, self.write).__aenter__()
        await self.mcp_session.initialize()
    
    async def recognize_captcha(self, image_path: str) -> str:
        """识别验证码"""
        with open(image_path, "rb") as f:
            image_data = base64.b64encode(f.read()).decode()
        
        result = await self.mcp_session.call_tool(
            "captcha_recognize",
            {"image_data": image_data}
        )
        
        return result.content[0].text
```

## 🧪 测试

```bash
# 运行所有测试
pytest

# 运行测试并显示覆盖率
pytest --cov=ocr_mcp

# 运行特定测试文件
pytest tests/test_captcha_tool.py

# 运行测试并生成详细报告
pytest -v --cov=ocr_mcp --cov-report=html
```

## 📦 项目结构

```
free_ocr/
├── ocr_mcp/                 # 主包
│   ├── __init__.py
│   ├── __main__.py          # 入口模块
│   ├── server.py            # MCP服务器核心
│   ├── tools/               # 工具模块
│   │   ├── __init__.py
│   │   ├── base_tool.py     # 工具基类
│   │   ├── captcha_tool.py  # 验证码识别工具
│   │   └── preprocess_tool.py # 图像预处理工具
│   └── utils/               # 工具函数
│       ├── __init__.py
│       ├── logger.py        # 日志工具
│       └── image_utils.py   # 图像处理工具
├── tests/                   # 测试文件
│   ├── __init__.py
│   ├── conftest.py          # 测试配置
│   ├── test_image_utils.py  # 图像工具测试
│   ├── test_captcha_tool.py # 验证码工具测试
│   └── test_preprocess_tool.py # 预处理工具测试
├── examples/                # 使用示例
├── requirements.txt         # 依赖列表
├── pyproject.toml          # 项目配置
└── README.md               # 项目文档
```

## ⚙️ 配置

### 环境变量

```bash
# 日志级别
export OCR_LOG_LEVEL=INFO

# 最大图像大小(MB)
export OCR_MAX_IMAGE_SIZE=5
```

### 性能优化建议

1. **图像质量**: 确保图像清晰度足够(建议最小尺寸: 100x40像素)
2. **图像格式**: 使用PNG或JPEG格式
3. **图像大小**: 控制在5MB以内
4. **预处理**: 对于模糊图像，启用预处理选项

## 🔧 开发

### 代码规范

```bash
# 代码格式化
black ocr_mcp/

# 代码检查
flake8 ocr_mcp/

# 类型检查
mypy ocr_mcp/
```

### 添加新工具

1. 继承`BaseTool`类
2. 实现必要的方法
3. 在服务器中注册工具
4. 添加相应的测试

```python
from ocr_mcp.tools.base_tool import BaseTool

class CustomTool(BaseTool):
    @property
    def name(self) -> str:
        return "custom_tool"
    
    @property
    def description(self) -> str:
        return "自定义工具描述"
    
    @property
    def input_schema(self) -> Dict[str, Any]:
        return {
            "type": "object",
            "properties": {
                "param": {"type": "string"}
            },
            "required": ["param"]
        }
    
    async def execute(self, **kwargs) -> Any:
        # 实现工具逻辑
        return {"result": "success"}
```

## 🐛 故障排除

### 常见问题

**Q: 连接MCP服务器失败**
A: 检查Python环境和依赖安装，确保服务器进程正常启动

**Q: 识别准确率低**
A: 尝试启用图像预处理，或检查图像质量

**Q: 处理速度慢**
A: 减少图像尺寸，确保图像清晰度

### 错误码说明

| 错误码 | 错误类型 | 描述 |
|--------|----------|------|
| -32600 | Invalid Request | 无效的JSON-RPC请求 |
| -32601 | Method not found | 工具不存在 |
| -32602 | Invalid params | 参数格式错误 |
| -32603 | Internal error | 服务器内部错误 |
| -1001 | Image decode error | 图像解码失败 |
| -1002 | OCR processing error | OCR处理失败 |

## 📄 许可证

本项目采用MIT许可证。详见[LICENSE](LICENSE)文件。

## 🤝 贡献

欢迎提交Issue和Pull Request！

1. Fork本项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开Pull Request

## 📞 支持

如果您在使用过程中遇到问题，请：

1. 查看[文档](docs/)
2. 搜索[Issues](../../issues)
3. 提交新的[Issue](../../issues/new)

## 🙏 致谢

- [ddddocr](https://github.com/sml2h3/ddddocr) - 优秀的OCR识别库
- [MCP](https://modelcontextprotocol.io) - Model Context Protocol标准
- [Pillow](https://pillow.readthedocs.io/) - Python图像处理库

---

**OCR MCP系统** - 为AI模型提供强大的验证码识别能力 🚀
